set debug stdout

do base_system.ini

; Configuration hacks

set cpu config=invertabsolute=enable
set cpu config=b29test=enable
set cpu config=dis_enable=enable
;set cpu config=auto_append_disable=enable
set cpu config=lprp_highonly=enable
set cpu config=steady_clock=enable
;set cpu config=degenerate_mode=enable
set cpu config=append_after=enable
set cpu config=super_user=disable
set cpu config=epp_hack=enable
set cpu config=halt_on_unimplemented=enable

;set cpu debug=all
;set cpu debug=trace
;set cpu debug=trace;fault;intr;regdumppr
;set cpu debug=fault;intr
;set cpu debug=regdumpaqi
;set cpu debug=appending
;set cpu debug=trace;regdump;addrmod;appending;fault;intr
;set cpu debug=regdumpdsbr
;set cpu debug=appending
;set iom debug=all
;set scu debug=all
;set clk debug
;set timer  debug
;set opcon  debug=all
;set tape debug=all
set tape watch

attach -r tape0  20184.tap 
set tape0 rewind

ld_system_book  system_book_12_5.ascii
;boot iom0

;set debug dps8.deb
;set log dps8.log
; 1093571
;dbgstart 1090000
;br 0371
;br 0556
;br 00032553

;; The EPP0 instruction
;br 032553
;
; The EPP0 instruction less 1
;dbgstart 1093567

; The TRA PR6
;br 032543

;dbgstart 1093567

; The LDQ instruction
;dbgstart 1095980


; The SREG at the start of bootload_io$init
;dbgstart 1095974

; The fault occurs at cycle 1096014, IC 011127
;dbgstart 1096000
;br 011127

; Start of channel_mailbox setup 
;br 013523

; bootload_io$init
;dbgstart 1095982
;set cpu debug=trace;intr;fault;regdump
;set iom debug=all
;set opcon  debug=all

; debugging malformed console messages
; 1119538 is cycle at time of first con_iom_cmd; (the alert rpobe)
; 1120549 is cycle at the end of the pause_for_status loop
; 1202407 is cycle of crashng MLR
; dbgstart 1202407
;set cpu debug=trace;intr;fault;regdump;appending;addrmod
;set iom debug=all
;set opcon  debug=all

;; Unimplemented opcode cycle 1232719
;dbgstart 1232000
;set cpu debug=trace;intr;fault;regdumpaqi

;; Looping
;;dbgstart 1232000
;dbgstart 1235642
;set cpu debug=trace;intr;fault;regdumpaqi
;set iom debug=all
;set opcon debug=all
;set tape debug=all

;; It doesn't look like the console model number is being correctly detected...
;; 1119538 is cycle at time of first con_iom_cmd; (the alert rpobe)
;dbgstart 1154373
;set cpu debug=trace;intr;fault;regdumpaqi
;set iom debug=all
;set opcon debug=all
;set tape debug=all

; Address of first_message after formline: 00033624

;; Loop over console write command
;dbgstart 1154635

; Looking for the first_message call
;dbgstart 1119538

;set cpu debug=trace;intr;fault;regdumpaqi;traceex;regdumpidx
;set iom debug=all
;set opcon debug=all
;set tape debug=all
;set cpu debug=traceex

; Formline debugging

;; bootload_error+0601 first_message
;br 010361; echo first; set cpu debug=trace; g
;
;;bound_bootload_0:bootload_formline+060 main_char_loop after tsx7 get_input_char
;br 011630; echo get_in; ex A,X1,pr5.snr,pr5.wordno,pr5.char; g
;
;; bound_bootload_0:bootload_formline+0774 put_one_char entry
;br 012544; echo put; ex A; g
;
;; bound_bootload_0:bootload_formline+070 main_char_loop.special_char after
;;   tsx7    get_input_char
;br 011640; echo special; ex A; g
;
;; bound_bootload_0:bootload_formline+0132 main_char_loop.acc_string mlr
;br 011702; echo get arg; e x6,pr1.snr,pr1.wordno,pr1.char; set cpu debug=traceex; g
;br 011705; set cpu nodebug=traceex; g
;
;; bound_bootload_0:bootload_formline+0260 ascii.no_trim
;br 012030; echo notrim; echo ptr; ex pr1.snr,pr1.wordno,pr1.char,pr7.snr,pr7.wordno,pr7.char; echo cnt; ex a; set cpu debug=traceex;g
;;br 012034; set cpu nodebug=traceex; g
;
;; bound_bootload_0:bootload_formline+045 bootload_formline after epp5
;br 011615; echo control string ptr; ex pr5.snr,pr5.wordno; g
;
;; bound_bootload_0:bootload_formline+051 bootload_formline after
;;   epp7    output_string,x2
;br 011621; echo count; ex x1; g
;
;; bound_bootload_0:bootload_formline+052 
;;   lxl4    output_string_limit,x2
;br 011622; echo output length; ex x4; g
;
;; bound_bootload_0:bootload_formline+0761  formline exit
;br 012531; echo formline exit
;
;; bound_bootload_0:bootload_formline+0764 get_input_char
;br 012534; echo get_input_char; ex pr5.snr,pr5.wordno,pr5.char; set cpu debug=traceex; g
;br 012537; set cpu nodebug=traceex; g
;
;; ound_bootload_0:bootload_formline+0232 ascii_common
;br 012002; echo ascii common; ex pr1.snr,pr1.wordno,pr1.char,a; set cpu debug=traceex; g
;br 012006; set cpu nodebug=traceex; g

boot iom0
